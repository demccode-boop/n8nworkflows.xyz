{"id":"1yJTPMbE7n3YfDDf","meta":{"instanceId":"08f9f428afd234e114ec97ff7f86661df0ddc03847c7df5ade37126368e99491","templateCredsSetupCompleted":true},"name":"Enrich-Hubspot-Companies","tags":[],"nodes":[{"id":"d0cf2815-a093-4881-b648-aa8beca744f9","name":"Extract Domain","type":"n8n-nodes-base.function","position":[-112,-112],"parameters":{"functionCode":"return items.map(item => {\n  const src = item.json || {};\n  const p = src.properties || {};\n\n  const domain =\n    p[\"domain\"]?.value ||\n    p[\"domain\"] ||\n    p[\"website\"]?.value ||\n    p[\"website\"] ||\n    src.domain ||\n    src.website ||\n    \"\";\n\n  const companyId =\n    src.id ||\n    src.objectId ||\n    src[\"objectId\"] ||\n    src.companyId ||\n    \"\";\n\n  return {\n    json: {\n      companyId,\n      domain\n    }\n  };\n});\n"},"typeVersion":1},{"id":"33106258-bafd-42bf-b043-4162b8736f3d","name":"CompanyEnrich - Enrich by Domain","type":"n8n-nodes-base.httpRequest","position":[224,-64],"parameters":{"url":"https://api.companyenrich.com/companies/enrich","options":{},"sendQuery":true,"jsonHeaders":"{\n  \"Authorization\": \"Bearer YOUR_TOKEN_HERE\",        \n  \"Accept\": \"application/json\"\n}\n","sendHeaders":true,"specifyHeaders":"json","queryParameters":{"parameters":[{"name":"domain","value":"={{ $json.domain }}"}]}},"typeVersion":4},{"id":"269f745e-27bb-496d-b35c-731a8cea580c","name":"Check Enrich Success","type":"n8n-nodes-base.if","position":[592,-112],"parameters":{"conditions":{"number":[],"string":[{"value1":"={{ $json && $json.statusCode ? String($json.statusCode) : '' }}","operation":"isEmpty"}],"boolean":[]}},"typeVersion":1},{"id":"d2c04f1a-7c78-4a8c-bb04-e1ebc85a4ff6","name":"HubSpot - Update Company","type":"n8n-nodes-base.hubspot","position":[976,-128],"parameters":{"resource":"company","companyId":"={{ $json.companyId }}","operation":"update","updateFields":{"city":"={{ $json.location.city.name }}","name":"={{ $json.name }}","postalCode":"={{ $json.location.postal_code }}","websiteUrl":"={{ $json.website }}","description":"={{ $json.description }}","phoneNumber":"={{ $json.location.phone }}","stateRegion":"={{ $json.location.state.name }}","yearFounded":"={{ $json.founded_year }}","countryRegion":"={{ $json.location.country.name }}","streetAddress":"={{ $json.location.address }}","twitterHandle":"={{ $json.socials.twitter_url }}","companyDomainName":"={{ $json.domain }}","linkedInCompanyPage":"={{ $json.socials.linkedin_url }}"},"authentication":"appToken"},"credentials":{"hubspotAppToken":{"id":"credential-id","name":"hubspotAppToken Credential"}},"typeVersion":1},{"id":"529fa692-7130-4571-9138-22b3d4e0b513","name":"On Error (Log)","type":"n8n-nodes-base.noOp","position":[800,-96],"parameters":{},"typeVersion":1},{"id":"5b86f343-9557-4b80-b056-e4fda81c272c","name":"Schedule Trigger","type":"n8n-nodes-base.scheduleTrigger","position":[-480,-112],"parameters":{"rule":{"interval":[{"field":"weeks"}]}},"typeVersion":1.2},{"id":"c3ddcc4c-841e-42f0-a663-71a48187cb30","name":"Loop Over Items","type":"n8n-nodes-base.splitInBatches","position":[48,-112],"parameters":{"options":{"reset":false}},"typeVersion":3,"alwaysOutputData":false},{"id":"529ed625-bdd5-40d3-8b9b-ae5d5f186b2a","name":"Merge","type":"n8n-nodes-base.merge","position":[400,-112],"parameters":{"mode":"combine","options":{},"combineBy":"combineByPosition"},"typeVersion":3.2},{"id":"4b00640e-f7bf-40fb-ac58-9c154faac18b","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[-1104,-528],"parameters":{"width":608,"height":608,"content":"## AI COMPANY ENRICHMENT FOR NEW OR UPDATED HUBSPOT COMMPANIES\n\n### üìå How This Workflow Works?\n1. **Schedule Trigger:** Finds the newly created or updated companies in a set time period.\n2. **Extract Domain:** Extracts the domain seeds of the companies for CompanyEnrich enrichment API.\n3. **Hubspot Update Company:** Updates the corresponding company with enriched data if enrichment success is false we log the error\n\n### üõ†Ô∏è Before using\n‚úî Create an Hubspot private app with company read and write scopes, add your app's credentials for both hubspot nodes.  \n‚úî Ensure companies have a valid domain (required for enrichment)  \n‚úî Create an Company Enrich account and enter your api key to HTTP Request node's header where it says `YOUR_API_KEY`.  \n‚úî Map the enriched datas in Hubspot Company Update nodes.\n\n### CUSTOMIZATION\n1. **Filters:** Change the time period in schedule trigger and get recently updated companies nodes  \n2. **Fields to Update:** Map the custom company properties in Update companies node\n\n\nFor more customization instructions, check the respective node‚Äôs sticky notes."},"typeVersion":1},{"id":"c9e7f287-86e7-4128-b737-83cdd0488d0e","name":"Get recently created/updated companies","type":"n8n-nodes-base.hubspot","position":[-288,-112],"parameters":{"resource":"company","operation":"getRecentlyCreatedUpdated","returnAll":true,"authentication":"appToken","additionalFields":{"since":"={{ new Date(new Date($json.timestamp).getTime() - 7*24*60*60*1000)\n    .toISOString()\n    .slice(0,10) }}\n"}},"credentials":{"hubspotAppToken":{"id":"credential-id","name":"hubspotAppToken Credential"}},"typeVersion":2.2},{"id":"87d69b31-56d7-47a2-82e7-9fe3a6e175e5","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","position":[-480,-400],"parameters":{"color":7,"width":464,"height":480,"content":"## Schedule Trigger & Extract Domain\n\nControl how far back companies are enriched:\n\n1. **Schedule Trigger:**  \n   Set how often the workflow runs.\n\n2. **HubSpot Get Companies node:**  \n   Change the number in `7*24*60*60*1000`.  \n   - `7` = last 7 days  \n   -  Change this number to any value you want (e.g. `1` = last 1 day, `14` = last 14 days)\n"},"typeVersion":1},{"id":"91056c3e-7c15-4fc5-b73f-6e8a92d39eca","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","position":[592,-288],"parameters":{"color":7,"width":480,"height":368,"content":"## Update Companies\n\nControl which properties are sent to HubSpot by mapping them in the **HubSpot Update Company** node.\n\n‚ö†Ô∏è Be careful to map **only one value per field** to avoid HubSpot API errors.\n"},"typeVersion":1},{"id":"31c2521f-3261-4f95-bdd5-cab02557809c","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","position":[48,-240],"parameters":{"color":7,"width":448,"height":320,"content":"## Enrichment Loop\n\nEnter your CompanyEnrich API key in the **HTTP Request** node where it says `YOUR_API_KEY`.\n"},"typeVersion":1}],"active":false,"pinData":{},"settings":{"executionOrder":"v1"},"versionId":"1f2d262f-5936-4ccc-9b09-b90c88125847","connections":{"Merge":{"main":[[{"node":"Check Enrich Success","type":"main","index":0}]]},"Extract Domain":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"On Error (Log)":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"CompanyEnrich - Enrich by Domain","type":"main","index":0},{"node":"Merge","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"Get recently created/updated companies","type":"main","index":0}]]},"Check Enrich Success":{"main":[[{"node":"HubSpot - Update Company","type":"main","index":0}],[{"node":"On Error (Log)","type":"main","index":0}]]},"HubSpot - Update Company":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"CompanyEnrich - Enrich by Domain":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Get recently created/updated companies":{"main":[[{"node":"Extract Domain","type":"main","index":0}]]}}}