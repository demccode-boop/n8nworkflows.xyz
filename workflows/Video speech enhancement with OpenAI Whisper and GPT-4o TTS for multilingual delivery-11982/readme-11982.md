Video speech enhancement with OpenAI Whisper and GPT-4o TTS for multilingual delivery

https://n8nworkflows.xyz/workflows/video-speech-enhancement-with-openai-whisper-and-gpt-4o-tts-for-multilingual-delivery-11982


# Video speech enhancement with OpenAI Whisper and GPT-4o TTS for multilingual delivery

## 1. Workflow Overview

**Purpose:** This workflow takes user-submitted media (via an n8n Form), moves it through a remote processing pipeline (FTP/SSH), generates multilingual speech assets using **OpenAI Whisper (ASR)** and **GPT‑4o TTS** (text-to-speech), then uploads deliverables to **Google Drive** and sends a **Telegram notification**.

**Typical use cases**
- Enhancing or replacing speech tracks in videos
- Producing multilingual voiceovers for the same source content
- Automated media pipeline orchestration using remote servers (FTP/SSH) + OpenAI

### 1.1 Input Reception & Staging
Receives files from an n8n Form and stages them to a server via FTP/SSH.

### 1.2 Remote Pre-processing / Metadata Build
Invokes an HTTP step and code steps to prepare processing metadata; merges outputs needed for later stages.

### 1.3 Asset Enumeration & Batch Processing
Fetches a list of items (likely target languages/segments), builds an iterable list, and processes them in batches.

### 1.4 AI Speech Processing (Whisper + GPT‑4o TTS)
Transforms per-batch payloads and calls OpenAI (LangChain OpenAI node) to transcribe/translate and/or synthesize speech.

### 1.5 Packaging, Delivery & Notifications
Uploads results via FTP/SSH, then publishes to Google Drive and Telegram.

> Note: Many nodes have empty parameters in the provided JSON export, so the document describes the *observable structure, responsibilities, and required configuration* to make it functional.

---

## 2. Block-by-Block Analysis

### Block 1 — Input Reception & Initial Staging
**Overview:** Collects media from a Form Trigger and pushes it to a remote environment to start processing.

**Nodes involved:** `Attach files2` → `C3` → `S` → `E` → `S1`

#### Node: Attach files2
- **Type / role:** Form Trigger (`n8n-nodes-base.formTrigger`) — entry point to collect files and fields from a hosted n8n form.
- **Configuration (interpreted):**
  - Uses a fixed webhook ID (generated by n8n).
  - `executeOnce: true` suggests this workflow is intended to run once during testing; disable for production.
- **I/O:**
  - **Output:** Form submission payload + binary file(s) (if configured in the form).
  - **Next:** `C3`
- **Edge cases / failures:**
  - Missing file field / no binary data.
  - Large upload limits (n8n instance limits, reverse proxy limits).
  - If left `executeOnce`, subsequent submissions won’t run.
- **Version notes:** Node typeVersion `2.3`.

#### Node: C3
- **Type / role:** Set (`n8n-nodes-base.set`) — normalize incoming fields / create variables for downstream nodes.
- **Configuration:** Not specified in JSON; typically used to map:
  - filename, target paths, language list, job id, etc.
- **I/O:** `Attach files2` → `C3` → `S`
- **Edge cases:**
  - Expressions referencing absent fields cause evaluation errors or empty values depending on settings.

#### Node: S
- **Type / role:** FTP (`n8n-nodes-base.ftp`) — uploads the incoming file(s) to a remote server.
- **Configuration:** Not provided; must define:
  - Operation (Upload / Put)
  - Remote path
  - Binary property name (commonly `data`)
  - Credentials (FTP host/user/pass or key-based if supported)
- **I/O:** `C3` → `S` → `E`
- **Failures:**
  - Auth/connection errors, passive mode/firewall issues
  - Path permissions
  - Binary property missing

#### Node: E
- **Type / role:** SSH (`n8n-nodes-base.ssh`) — executes remote commands (e.g., moving files, starting ffmpeg, preparing directories).
- **Configuration:** Not provided; must define:
  - Host/port/user + key or password
  - Command(s)
- **I/O:** `S` → `E` → `S1`
- **Failures:**
  - Auth/key issues
  - Command exit non-zero
  - Timeout on long-running tasks

#### Node: S1
- **Type / role:** FTP — likely downloads artifacts or verifies staged content; could also upload additional config.
- **I/O:** `E` → `S1` → `W`
- **Failures:** same FTP considerations as `S`.

---

### Block 2 — Remote Pre-processing & Merge Setup
**Overview:** Calls an HTTP endpoint and code transformations, then merges two streams (one from HTTP/code, one from SSH) to prepare the next stage.

**Nodes involved:** `W` → `W1` → (`M`, `E1`) and `E1` → `M`

#### Node: W
- **Type / role:** HTTP Request (`n8n-nodes-base.httpRequest`) — calls an external service (commonly: transcription endpoint trigger, job status, or media processing API).
- **Configuration:** Not provided; must define method/URL/auth and expected response.
- **I/O:** `S1` → `W` → `W1`
- **Failures:**
  - 4xx/5xx responses
  - Timeouts
  - Invalid JSON parsing if response is not JSON

#### Node: W1
- **Type / role:** Code (`n8n-nodes-base.code`) — parses HTTP output and shapes data for subsequent merge.
- **I/O:**
  - Output 1 → `M` (index 0)
  - Output 2 → `E1` (index 0)
- **Notes:** Two outgoing connections indicates it emits data used by both merge and SSH paths.
- **Failures:**
  - Runtime JS errors
  - Missing fields from `W` response

#### Node: E1
- **Type / role:** SSH — likely performs server-side step based on parsed metadata (e.g., generate segment list, extract audio, create prompts).
- **I/O:** `W1` → `E1` → `M` (merge input index 1)
- **Failures:** SSH auth/timeout/command errors.

#### Node: M
- **Type / role:** Merge (`n8n-nodes-base.merge`) — combines:
  - Input 0 from `W1`
  - Input 1 from `E1`
- **Configuration:** Not visible; must choose merge mode (e.g., *Merge By Index* is common).
- **I/O:** `M` → `S2`
- **Edge cases:**
  - Unequal item counts between inputs
  - Wrong merge mode causing missing fields

---

### Block 3 — Asset Enumeration & Batch Loop
**Overview:** Retrieves a list of items (targets), converts it into iterable items, then processes in batches.

**Nodes involved:** `S2` → `S3` → `L` → (`L1`, `F`) and `U` → `L`

#### Node: S2
- **Type / role:** FTP — fetches a generated file/list (e.g., JSON with segments/languages, subtitle file, manifests).
- **I/O:** `M` → `S2` → `S3`
- **Failures:** missing remote file, permissions, binary decode issues.

#### Node: S3
- **Type / role:** Code — converts downloaded content into structured items for batching.
- **I/O:** `S2` → `S3` → `L`
- **Potential outputs:** array of items like `{ language, text, segmentId, inputAudioPath }`
- **Failures:** parsing errors (CSV/JSON), empty list.

#### Node: L
- **Type / role:** Split In Batches (`n8n-nodes-base.splitInBatches`) — controls iteration over items.
- **I/O:**
  - Main output 0 → `L1` (likely “done” or debugging limiter)
  - Main output 1 → `F` (batch item processing)
- **Edge cases:** batch size misconfigured (defaults to 1 if not set), infinite loops if not connected properly.

#### Node: L1
- **Type / role:** Limit (`n8n-nodes-base.limit`) — appears connected but has no outputs; likely used for debugging/previewing a subset.
- **I/O:** `L` → `L1` (no downstream)
- **Edge cases:** If intended for production gating, it currently does nothing because it isn’t connected onward.

#### Node: U
- **Type / role:** Google Drive (`n8n-nodes-base.googleDrive`) — **connected later** but loops back into batching (`U` → `L`).
- **On-error behavior:** `onError: continueRegularOutput` — failures won’t stop the workflow.
- **Role in loop:** This creates a loop: after uploading to Drive, execution returns to `L` to fetch the next batch.
- **Failures:**
  - OAuth/token expiry
  - Permission/drive quota
  - Folder ID invalid
- **Version:** typeVersion `3`.

---

### Block 4 — AI Speech Processing (Whisper + GPT‑4o TTS)
**Overview:** For each batch item, prepares an OpenAI request, runs OpenAI via the LangChain OpenAI node, then post-processes and triggers both packaging and audio creation paths.

**Nodes involved:** `F` → `A` → `R1` → (`O`, `M1`)

#### Node: F
- **Type / role:** Code — builds the prompt/payload for OpenAI (e.g., Whisper transcription inputs or GPT‑4o TTS instructions).
- **I/O:** `L` → `F` → `A`
- **Key variables (expected):**
  - text to synthesize, language/voice, desired format, segment timing, etc.
- **Failures:** malformed payload; missing fields from `L` items.

#### Node: A
- **Type / role:** OpenAI (LangChain) (`@n8n/n8n-nodes-langchain.openAi`) — core AI call.
- **Configuration:** Not specified; must choose operation (commonly Chat/Responses) and model(s).
  - For this workflow title, likely:
    - **Whisper** for transcription (audio → text)
    - **GPT‑4o TTS** for speech synthesis (text → audio)
- **Credentials:** OpenAI API key configured in n8n credentials.
- **I/O:** `F` → `A` → `R1`
- **Failures:**
  - Rate limits, model access restrictions
  - Payload too large
  - Audio format constraints for Whisper/TTS
- **Version:** typeVersion `1.8`.

#### Node: R1
- **Type / role:** Code — parses AI output into:
  - A stream for HTTP request `O` (e.g., calling TTS endpoint or downstream service)
  - A stream for merge `M1` (metadata accumulation)
- **I/O:** `A` → `R1` → `O` and `M1` (input 0)
- **Failures:** unexpected OpenAI response schema; missing properties.

#### Node: O
- **Type / role:** HTTP Request — likely calls OpenAI TTS REST endpoint (or another TTS/asset endpoint) if not done directly in node `A`.
- **I/O:** `R1` → `O` → `C4`
- **Failures:** same as other HTTP nodes; binary response handling (audio) must be configured.

---

### Block 5 — Deliverable Assembly, Uploads, Notifications
**Overview:** Produces audio files, uploads intermediate/final assets via FTP, runs remote assembly via SSH, then uploads to Drive and notifies via Telegram.

**Nodes involved:** `C4` → `S4` → `M1` → `B` → `S5` → `T` → `S6` → (`U`, `S7`)

#### Node: C4
- **Type / role:** Code — transforms HTTP output into binary/audio + metadata suitable for FTP upload.
- **I/O:** `O` → `C4` → `S4`
- **Failures:** incorrect binary property name; audio data missing.

#### Node: S4
- **Type / role:** FTP — uploads generated audio (per segment/language) back to server storage.
- **I/O:** `C4` → `S4` → `M1` (input 1)
- **Failures:** FTP transfer errors, path permissions.

#### Node: M1
- **Type / role:** Merge — combines:
  - Input 0 from `R1` (metadata)
  - Input 1 from `S4` (upload confirmation/path)
- **I/O:** `M1` → `B`
- **Edge cases:** mismatched items between both branches.

#### Node: B
- **Type / role:** Code — builds final packaging instructions (e.g., ffmpeg commands, manifest updates, naming conventions).
- **I/O:** `M1` → `B` → `S5`
- **Failures:** missing merged fields, wrong paths.

#### Node: S5
- **Type / role:** FTP — uploads packaging config or pulls files required for final assembly.
- **I/O:** `B` → `S5` → `T`

#### Node: T
- **Type / role:** SSH — runs remote assembly (e.g., mux new audio into video, render final outputs, zip deliverables).
- **I/O:** `S5` → `T` → `S6`
- **Failures:** long-running command timeouts; ffmpeg errors; missing codecs.

#### Node: S6
- **Type / role:** FTP — downloads final deliverables from server (or uploads to a distribution location). Based on downstream nodes, it likely **downloads** into n8n to upload to Drive.
- **I/O:** `T` → `S6` → `U` and `S7`
- **Failures:** missing output file; large binary memory constraints in n8n.

#### Node: S7
- **Type / role:** Telegram (`n8n-nodes-base.telegram`) — sends a completion message (and possibly a link).
- **I/O:** `S6` → `S7`
- **Failures:** bot token invalid; chat ID wrong; file too large if sending attachments.
- **Version:** `1.2`.

---

## 3. Summary Table

| Node Name | Node Type | Functional Role | Input Node(s) | Output Node(s) | Sticky Note |
|---|---|---|---|---|---|
| Sticky Note1 | Sticky Note | Comment container | — | — |  |
| Attach files2 | Form Trigger | Workflow entry; collect files | — | C3 |  |
| C3 | Set | Normalize fields / set variables | Attach files2 | S |  |
| S | FTP | Transfer file(s) to server | C3 | E |  |
| E | SSH | Remote prep/processing | S | S1 |  |
| S1 | FTP | Transfer verification/artifacts | E | W |  |
| W | HTTP Request | Call external API/service | S1 | W1 |  |
| W1 | Code | Parse/shape HTTP response; fork flow | W | M, E1 |  |
| E1 | SSH | Remote step driven by W1 output | W1 | M |  |
| M | Merge | Combine W1 + E1 results | W1, E1 | S2 |  |
| S2 | FTP | Fetch list/manifest | M | S3 |  |
| S3 | Code | Convert manifest to items | S2 | L |  |
| L | Split In Batches | Iterate items | S3, U | L1, F |  |
| L1 | Limit | Debug/limit branch (unused) | L | — |  |
| F | Code | Build AI request payload | L | A |  |
| A | OpenAI (LangChain) | Whisper/TTS AI processing | F | R1 |  |
| R1 | Code | Parse AI output; fork to HTTP + merge | A | O, M1 |  |
| O | HTTP Request | Generate/obtain audio via API | R1 | C4 |  |
| C4 | Code | Convert API response to binary/audio | O | S4 |  |
| S4 | FTP | Upload generated audio | C4 | M1 |  |
| M1 | Merge | Combine metadata + upload result | R1, S4 | B |  |
| B | Code | Build packaging instructions | M1 | S5 |  |
| S5 | FTP | Transfer assembly config/assets | B | T |  |
| T | SSH | Assemble final deliverable(s) | S5 | S6 |  |
| S6 | FTP | Retrieve final output(s) | T | U, S7 |  |
| U | Google Drive | Upload deliverables; loop batching | S6 | L |  |
| S7 | Telegram | Notify completion | S6 | — |  |

---

## 4. Reproducing the Workflow from Scratch

1. **Create Form Trigger**
   - Add **Form Trigger** node named `Attach files2`.
   - Add a **File upload** field (ensure it produces binary data, commonly under property `data`).
   - Disable **Execute Once** for production.

2. **Add Set node (`C3`)**
   - Map/compute:
     - `jobId` (e.g., timestamp/UUID)
     - `originalFilename`
     - `remoteInputPath` and `remoteWorkingDir`
     - any user-selected options (target languages, voice, etc.)
   - Connect: `Attach files2` → `C3`.

3. **FTP upload to server (`S`)**
   - Add **FTP** node `S`, operation **Upload**.
   - Configure credentials (host, port, user, password).
   - Remote path expression example: `{{$json.remoteInputPath}}/{{$json.originalFilename}}`
   - Binary property: match your form upload (e.g., `data`).
   - Connect: `C3` → `S`.

4. **Remote prep via SSH (`E`)**
   - Add **SSH** node `E` with SSH credentials.
   - Command examples:
     - create working directory
     - move/rename uploaded file
     - extract audio with ffmpeg
   - Connect: `S` → `E`.

5. **FTP step (`S1`)**
   - Add **FTP** node `S1` (upload/download as needed by your design).
   - Connect: `E` → `S1`.

6. **HTTP call (`W`)**
   - Add **HTTP Request** node `W`.
   - Configure URL/method to your service (or OpenAI endpoints if applicable).
   - If expecting JSON, set response format to JSON.
   - Connect: `S1` → `W`.

7. **Code transform (`W1`)**
   - Add **Code** node `W1` to parse `W` response and produce:
     - stream A: data to merge
     - stream B: data for SSH node `E1`
   - Connect: `W` → `W1`.

8. **SSH step (`E1`)**
   - Add **SSH** node `E1` for additional remote processing based on `W1` outputs.
   - Connect: `W1` → `E1`.

9. **Merge (`M`)**
   - Add **Merge** node `M` (commonly *Merge By Index*).
   - Connect: `W1` → `M` (input 0) and `E1` → `M` (input 1).

10. **FTP manifest retrieval (`S2`)**
    - Add **FTP** node `S2` to fetch the produced manifest/list (JSON/CSV/SRT).
    - Connect: `M` → `S2`.

11. **Code list builder (`S3`)**
    - Add **Code** node `S3` to parse manifest and output one item per target (language/segment).
    - Connect: `S2` → `S3`.

12. **Split in Batches (`L`) + optional Limit (`L1`)**
    - Add **Split In Batches** `L`, set batch size (e.g., 1).
    - Connect: `S3` → `L`.
    - Add **Limit** node `L1` if you want a debug branch; otherwise remove it.
    - Connect: `L` → `L1` (optional).

13. **Prepare OpenAI payload (`F`)**
    - Add **Code** node `F` that maps each batch item into an OpenAI request structure:
      - transcription input (audio file reference) and/or
      - TTS input (text, voice, language, format).
    - Connect: `L` → `F`.

14. **OpenAI node (`A`)**
    - Add **OpenAI (LangChain)** node `A`.
    - Configure **OpenAI credentials** (API key).
    - Select the model/operation appropriate to your implementation:
      - Whisper for ASR (if audio in)
      - GPT‑4o TTS for speech synthesis (if text in)
    - Connect: `F` → `A`.

15. **Parse AI output (`R1`)**
    - Add **Code** node `R1` to:
      - extract text/audio URLs/base64/binary references
      - create metadata for filenames and remote paths
    - Connect: `A` → `R1`.

16. **HTTP TTS/audio retrieval (`O`)**
    - Add **HTTP Request** node `O` if you need a direct REST call to fetch audio (e.g., OpenAI TTS endpoint).
    - Configure to return **File/Binary** if it returns audio bytes.
    - Connect: `R1` → `O`.

17. **Convert to binary / finalize audio item (`C4`)**
    - Add **Code** node `C4` to ensure output includes binary property used by FTP node `S4`.
    - Connect: `O` → `C4`.

18. **FTP upload audio (`S4`)**
    - Add **FTP** node `S4` operation Upload (binary from `C4`).
    - Connect: `C4` → `S4`.

19. **Merge metadata + upload info (`M1`)**
    - Add **Merge** node `M1`.
    - Connect: `R1` → `M1` (input 0), `S4` → `M1` (input 1).

20. **Packaging instructions (`B`)**
    - Add **Code** node `B` to create final assembly instructions (paths, ffmpeg commands, output names).
    - Connect: `M1` → `B`.

21. **FTP config/assets (`S5`)**
    - Add **FTP** node `S5` to transfer configs/assets to server.
    - Connect: `B` → `S5`.

22. **SSH assemble (`T`)**
    - Add **SSH** node `T` to run final assembly (ffmpeg mux, render, zip).
    - Connect: `S5` → `T`.

23. **FTP get final output (`S6`)**
    - Add **FTP** node `S6` to download final deliverable(s) into n8n binary.
    - Connect: `T` → `S6`.

24. **Upload to Google Drive (`U`) and loop**
    - Add **Google Drive** node `U` (upload file).
    - Configure OAuth2 credentials and destination folder.
    - Set **On Error: Continue** if desired (as in JSON).
    - Connect: `S6` → `U`.
    - Connect: `U` → `L` to continue the next batch.

25. **Telegram notification (`S7`)**
    - Add **Telegram** node `S7` to send a message on completion/each batch.
    - Configure bot token credential + chat ID.
    - Connect: `S6` → `S7`.

---

## 5. General Notes & Resources

| Note Content | Context or Link |
|---|---|
| Le texte fourni provient exclusivement d’un workflow automatisé réalisé avec n8n, un outil d’intégration et d’automatisation. Ce traitement respecte strictement les politiques de contenu en vigueur et ne contient aucun élément illégal, offensant ou protégé. Toutes les données manipulées sont légales et publiques. | Disclaimer (provided in prompt) |
| Sticky Note1 has empty content. | No additional context was embedded in the workflow. |

